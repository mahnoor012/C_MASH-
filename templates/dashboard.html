{% extends 'base.html' %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}
  <h1>Welcome, {{ user.username }}!</h1>

  <section class="add-site">
    <h2>Add website</h2>
    <form method="post" class="site-form">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <div class="field">
        {{ form.name.label_tag }}<br>
        {{ form.name }}
        {{ form.name.errors }}
      </div>
      <div class="field">
        {{ form.url.label_tag }}<br>
        {{ form.url }}
        {{ form.url.errors }}
      </div>
      <button type="submit" class="btn">Add Website</button>
    </form>
  </section>

  <section class="sites-grid">
    {% if websites %}
      {% for site in websites %}
        <div class="site-card">
          <!-- Website URL link -->
          <a href="{{ site.url }}" target="_blank" rel="noopener noreferrer">
            <img src="https://www.google.com/s2/favicons?sz=128&domain_url={{ site.url|urlencode }}"
                 alt="{{ site.name }} logo"
                 onerror="this.style.display='none';" />
            <div class="site-name">{{ site.name }}</div>
          </a>

          <!-- 3-dot menu for deleting website -->
          <div class="dropdown">
            <button class="dropdown-btn">...</button>
            <div class="dropdown-content">
              <form method="POST" action="{% url 'delete_website' site.id %}">
                {% csrf_token %}
                <button type="submit" class="delete-btn">Delete</button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No websites added yet. Add one above.</p>
    {% endif %}
  </section>
{% endblock %}
